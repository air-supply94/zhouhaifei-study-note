---
title: csapp
order: 1
nav:
  title: base
  order: 5
---

## 数字

### 整数

- 逻辑右移: 左边补 0
- 算术右移: 左边补最高有效位
- 除以 2 的幂的补码除法,向下舍入: x / 2^k
- 除以 2 的幂的补码除法,向上舍入: (x + (1 << k) - 1) >> k

### 浮点数

- 原理: (-1)^s \* f ^ e
- 单精度: 1---8---23
- 双精度: 1---11---52
- bias = 2^k - 1
- 规格化(e 不全为 0 且不全为 1)
  - f = 1 + f
  - e = e - bias
- 非规格化(e 全为 0)
  - f = f
  - e = 1 - bias
- 特殊(e 全为 1)
  - f 全为 0---Infinity(s 代表正负)
  - f 不全为 0---NaN
- 舍入: 向偶舍入

## 汇编

### 2 种抽象

- 指令集体系结构或指令集架构: 定义机器级程序的格式和行为。处理器状态,指令格式,指令对状态对影响
- 虚拟内存: 提供的内存模型看上去是字节数组

### 常见寄存器

- %rip: 将要执行的下一条指令在内存中的地址
- 整数寄存器
- 浮点数寄存器
- 条件码寄存器保存最近执行的算术或逻辑指令的状态信息

## 异常

### 中断

异步发生的,是来自处理器外部的 I/O 设备的信号结果。不由任何一条专门的指令造成

### 陷阱和系统调用

是执行一条指令的结果。在用户程序和内核之间提供一个像过程一样的接口

### 故障

由错误情况引起(缺页)

- 如果被故障处理程序修正,将控制返回到引起故障的指令并重新执行
- 否则返回内核的 abort 程序,终止程序

### 终止

不可恢复的致命错误造成,从不将控制返回

## 进程

### 定义

一个执行中程序的实列。系统中的每个程序运行在某个进程的上下文

### 关键抽象

- 一个独立的逻辑控制流(程序独占使用寄存器)
- 一个私用地址空间(程序独占使用内存系统)

### 逻辑流

PC 值的序列。进程轮流使用处理器,每个进程执行一部分,然后被抢占(暂时挂起),然后轮到其他进程

### 并发流

一个逻辑流的执行在时间上和另一个逻辑流重叠

### 并行

两个流并发的运行在不同处理器或者计算机上

### 虚拟内存

为每一个进程提供一个假象,每一个进程看到的内存都是一致的。2^n

- 内核虚拟内存
- 用户栈
- 共享内存
- 运行时堆
- 程序数据和代码(起点 0x00400000)

### 用户和内核模式

一种机制。限制一个应用程序可以执行的指令以及它可以访问的地址空间范围

- 普通函数运行在用户模式中，限制了函数可以执行的指令类型与栈
- 内核模式可访问内核的栈,访问任何内存空间,执行任何指令集的指令

### 上下文切换

- 一个上下文由程序正确运行所需的状态组成。代码和数据,栈,通用目的寄存器,程序计数器,环境变量,打开文件描述符
- 调度: 当进程执行的某些时刻内核可以决定抢占当前进程,并重新开始一个先前被抢占了的进程。使用上下文切换的机制来转移到新的进程
  - 保存当前的上下文
  - 恢复某个先前被抢占进程的上下文
  - 将控制传递给这个恢复的进程
