---
title: csapp
order: 1
nav:
  title: base
  order: 5
---

## 数字

### 整数

- 逻辑右移: 左边补 0
- 算术右移: 左边补最高有效位
- 除以 2 的幂的补码除法,向下舍入: x / 2^k
- 除以 2 的幂的补码除法,向上舍入: (x + (1 << k) - 1) >> k

### 浮点数

- 原理: (-1)^s \* f ^ e
- 单精度: 1---8---23
- 双精度: 1---11---52
- bias = 2^k - 1
- 规格化(e 不全为 0 且不全为 1)
  - f = 1 + f
  - e = e - bias
- 非规格化(e 全为 0)
  - f = f
  - e = 1 - bias
- 特殊(e 全为 1)
  - f 全为 0---Infinity(s 代表正负)
  - f 不全为 0---NaN
- 舍入: 向偶舍入

## 汇编

### 2 种抽象

- 指令集体系结构或指令集架构: 定义机器级程序的格式和行为。处理器状态,指令格式,指令对状态对影响
- 虚拟内存: 提供的内存模型看上去是字节数组

### 常见寄存器

- %rip: 将要执行的下一条指令在内存中的地址
- 整数寄存器
- 浮点数寄存器
- 条件码寄存器保存最近执行的算术或逻辑指令的状态信息

## 异常

### 中断

异步发生的,是来自处理器外部的 I/O 设备的信号结果。不由任何一条专门的指令造成

### 陷阱和系统调用

是执行一条指令的结果。在用户程序和内核之间提供一个像过程一样的接口

### 故障

由错误情况引起(缺页)

- 如果被故障处理程序修正,将控制返回到引起故障的指令并重新执行
- 否则返回内核的 abort 程序,终止程序

### 终止

不可恢复的致命错误造成,从不将控制返回

## 进程

### 定义

一个执行中程序的实列。系统中的每个程序运行在某个进程的上下文

### 关键抽象

- 一个独立的逻辑控制流(程序独占使用寄存器)
- 一个私用地址空间(程序独占使用内存系统)

### 逻辑流

PC 值的序列。进程轮流使用处理器,每个进程执行一部分,然后被抢占(暂时挂起),然后轮到其他进程

### 并发流

一个逻辑流的执行在时间上和另一个逻辑流重叠

### 并行

两个流并发的运行在不同处理器或者计算机上

### 虚拟内存

为每一个进程提供一个假象,每一个进程看到的内存都是一致的。2^n

- 内核虚拟内存
- 用户栈
- 共享内存
- 运行时堆
- 程序数据和代码(起点 0x00400000)

### 用户和内核模式

一种机制。限制一个应用程序可以执行的指令以及它可以访问的地址空间范围

- 普通函数运行在用户模式中，限制了函数可以执行的指令类型与栈
- 内核模式可访问内核的栈,访问任何内存空间,执行任何指令集的指令

### 上下文切换

- 一个上下文由程序正确运行所需的状态组成。代码和数据,栈,通用目的寄存器,程序计数器,环境变量,打开文件描述符
- 调度: 当进程执行的某些时刻内核可以决定抢占当前进程,并重新开始一个先前被抢占了的进程。使用上下文切换的机制来转移到新的进程
  - 保存当前的上下文
  - 恢复某个先前被抢占进程的上下文
  - 将控制传递给这个恢复的进程

### 状态

- 运行
- 停止: 进程的执行被挂起,且不会被执行(SIGCONT 唤醒)
- 终止: 进程永远停止
- zombie: 一个终止但还未被回收但进程

### fork

- 调用一次返回 2 次: 一次父进程创建(返回子进程的 PID),在子进程(返回 0)
- 并发执行: 子进程和父进程是并发执行的独立进程
- 相同但是独立的地址空间: 子进程和父进程虚拟内存地址,代码,数据段,堆,共享库,用户栈相同
- 共享文件: 子进程可以获得父进程打开的文件描述符

### daemon

是一类在后台运行的特殊进程,用于执行特定的系统任务。很多守护进程在系统引导的时候启动,并且一直运行直到系统关闭。另一些只在需要的时候才启动,完成任务后就自动结束

### [进程间通信(IPC)](https://www.jianshu.com/p/c1015f5ffa74)

- `管道(pipe)`
- `信号和信号量`
- Message 队列
- 共享内存
- `socket`

### 线程调度算法

- 先到先服务(FCFS): 队列
- 短作业优先(SJF): 平均等待时间 = 总等待时间 / 任务数
- 优先级队列
- 多级队列模型
  - 紧急任务仍然走高优队列,非抢占执行
  - 普通任务先放到优先级仅次于高优任务的队列中,并且只分配很小的时间片。如果没有执行完成,说明任务不是很短,就将任务下调一层
  - 下面一层,最低优先级的队列中时间片很大,长任务就有更大的时间片可以用

### 其他操作

- sleep(time)
- execve(filename): 加载并运行可执行文件

## 信号

- 一个信号就是一条小消息,它通知进程系统发生一个类型的事件
- 发送信号: 内核通过更新目的进程的上下文的某个状态,发送一个信号给目的进程
  - 内核检测的一个系统事件
  - 显示 kill
- 接受信号: 目的进程被内核强迫以某种方式对信号做出反应

### 发送信号

- 进程组: 每个进程都只属于一个进程组,默认子进程和父进程属于一个进程组
- kill
- job: 对一条命令行求值而创建的进程。任何时刻至多有一个前台 job 或多个后台任务
- alarm
